# MIR Table

Table模块主要对外提供查表功能，提供三种表，分别是FIB、PIT和CS表，下面分别对三种表应该提供的接口作出明确的定义。同时开发者应该实现一些统一的用于表数据增、删、改、查的数据结构，特别是名称前缀树。

## 1. 接口说明

### 1.1 Entry 

```go
type Entry interface {
  
}
```

作为 `IdentifierTree` 类的节点，保存实质的内容。

### 1.2 IdentifierTree 

IdentifierTree类用于存储键值对，键是层级化的标识，值是其他东西，可以是FIB表项、PIT表项、CS表项等。由于标识是层级化的结构，所以IdentifierTree的数据结构应该设计成前缀树的形式。

应实现以下一些接口：

- **GetMaxDepth**

  - 概述：获得树的最大深度

  - 参数：无

  - 返回值：

    | 序号 |  类型   | 示例值 |   说明   |
    | :--: | :-----: | :----: | :------: |
    |  1   | uint_64 |   0    | 树的深度 |

- **Size**

  - 概述：获得树的有效节点数

  - 参数：无

  - 返回值：

    | 序号 |  类型   | 示例值 |      说明      |
    | :--: | :-----: | :----: | :------------: |
    |  1   | uint_64 |   0    | 树的有效节点数 |

- **FindExactMatch**

  - 概述：查找与标识精确匹配的节点

  - 参数：

    | 序号 |     名称      |    类型     | 示例值 |        说明        |
    | :--: | :-----------: | :---------: | :----: | :----------------: |
    |  1   | identifierPtr | *Identifier |  nil   | Identifier对象指针 |

  - 返回值：

    | 序号 |  类型  | 示例值 |    说明    |
    | :--: | :----: | :----: | :--------: |
    |  1   | *Entry |   0    | 树节点指针 |

- **FindLongestPrefixMatch**

  - 概述：找与标识最长前缀匹配的节点

  - 参数：

    | 序号 |     名称      |    类型     | 示例值 |        说明        |
    | :--: | :-----------: | :---------: | :----: | :----------------: |
    |  1   | identifierPtr | *Identifier |  nil   | Identifier对象指针 |

  - 返回值：

    | 序号 |  类型  | 示例值 |    说明    |
    | :--: | :----: | :----: | :--------: |
    |  1   | *Entry |   0    | 树节点指针 |

- **Delete**

  - 概述：删除与标识精确匹配的节点

  - 参数：

    | 序号 | 名称          | 类型        | 示例值 | 说明               |
    | ---- | ------------- | ----------- | ------ | ------------------ |
    | 1    | identifierPtr | *Identifier | nil    | Identifier对象指针 |

  - 返回值：

    | 序号 | 类型  | 示例值 | 说明            |
    | ---- | ----- | ------ | --------------- |
    | 1    | error | nil    | 删除成功返回nil |

- **DeleteEmptyNode**

  - 概述：删除所有值为空的树节点

  - 参数：无

  - 返回值：

    | 序号 | 类型   | 示例值 | 说明       |
    | ---- | ------ | ------ | ---------- |
    | 1    | Uint64 | 0      | 删除的数量 |

### 1.3 FIBEntry

FIBEntry类用于存储FIB每条表项的具体内容，类的属性成员至少包括Identifier、表项有效期和下一跳列表。而下一跳列表中的每一项应包含下一跳逻辑接口号（uint64）和路由开销。

应实现以下一些接口：

- **GetIdentifier**

  - 概述：获得标识

  - 参数：无

  - 返回值：

    | 序号 | 类型        | 示例值 | 说明         |
    | ---- | ----------- | ------ | ------------ |
    | 1    | *Identifier | nil    | 标识对象指针 |

- **GetNextHops**

  - 概述：获得下一跳列表，下一跳列表应该按cost从小到大排序

  - 参数：无

  - 返回值：

    | 序号 | 类型          | 示例值 | 说明           |
    | ---- | ------------- | ------ | -------------- |
    | 1    | * NextHopList | 无     | 下一跳列表指针 |

- **HasNextHops**

  - 概述：判断有没有下一跳的信息

  - 参数：无

  - 返回值：

    | 序号 | 类型 | 示例值 | 说明               |
    | ---- | ---- | ------ | ------------------ |
    | 1    | bool | false  | 下一跳列表是否为空 |

- **HasNextHop**

  - 概述：判断logicFaceId是否在下一跳列表中

  - 参数：

    | 序号 | 名称        | 类型   | 示例值 | 说明       |
    | ---- | ----------- | ------ | ------ | ---------- |
    | 1    | logicFaceId | Uint64 | 3432   | 逻辑接口号 |

  - 返回值：

    | 序号 | 类型 | 示例值 | 说明                      |
    | ---- | ---- | ------ | ------------------------- |
    | 1    | bool | true   | logicFaceId在下一跳列表中 |

- **AddOrUpdateNextHop**

  - 概述：添加或更新一个下一跳信息

  - 参数：

    | 序号 | 名称        | 类型   | 示例值 | 说明       |
    | ---- | ----------- | ------ | ------ | ---------- |
    | 1    | logicFaceId | Uint64 | 3432   | 逻辑接口号 |
    | 2    | cost        | Uint64 | 80     | 路由开销   |

  - 返回值：

    | 序号 | 类型 | 示例值 | 说明               |
    | ---- | ---- | ------ | ------------------ |
    | 1    | bool | true   | 下一跳列表是否为空 |

- **RemoveNextHop**

  - 概述：删除一个下一跳信息

  - 参数：

    | 序号 | 名称        | 类型   | 示例值 | 说明       |
    | ---- | ----------- | ------ | ------ | ---------- |
    | 1    | logicFaceId | Uint64 | 3432   | 逻辑接口号 |

  - 返回值：无

### 1.4 FIB

FIB主要为路由器提供最长前缀匹配的功能，实现对标识路由表的增、删、改、查接口。并考虑到一个MIR路由器中可能存在多个FIB表的情况。

FIB单独构成一个类，并实现以下的内部接口：

- **FindLongestPrefixMatch**

  - 概述：传入一个Identifier对象作为参数，进行最长前缀匹配，标识会以Component进行分割，最长前缀匹配的意思是有尽量多个Component可以匹配到结果。开发者不要把最长前缀匹配理解成以字符或二进制为粒度的匹配。

  - 参数：

    | 序号 | 名称          | 类型        | 示例值 | 说明               |
    | ---- | ------------- | ----------- | ------ | ------------------ |
    | 1    | identifierPtr | *Identifier | 无     | 网络分组的标识指针 |

  - 返回值：

    | 序号 | 类型      | 示例值 | 说明                              |
    | ---- | --------- | ------ | --------------------------------- |
    | 1    | *FIBEntry | nil    | 如果匹配成功则返回FIB表项对象指针 |

- **FindExactMatch**

  - 概述：传入一个Identifier对象作为参数，进行精确匹配

  - 参数：

    | 序号 | 名称          | 类型        | 示例值 | 说明           |
    | ---- | ------------- | ----------- | ------ | -------------- |
    | 1    | identifierPtr | *Identifier | 无     | 网络分组的标识 |

  - 返回值：

    | 序号 | 类型      | 示例值 | 说明                              |
    | ---- | --------- | ------ | --------------------------------- |
    | 1    | *FIBEntry | nil    | 如果匹配成功则返回FIB表项对象指针 |

- **Insert**

  - 概述：传入一个Identifier对象作为参数，尝试在FIB表中添加新表项。 开发者应该注意考虑多线程调用此接口时的线程安全问题。

  - 参数：

    | 序号 | 名称          | 类型        | 示例值 | 说明                   |
    | ---- | ------------- | ----------- | ------ | ---------------------- |
    | 1    | identifierPtr | *Identifier | 无     | 网络分组的标识对象指针 |
    | 2    | logicFaceId   | Uint64      | 无     | 逻辑接口号             |
    | 3    | cost          | Uint64      | 0      | 链路开销               |

  - 返回值：

    | 序号 | 类型      | 示例值 | 说明                |
    | ---- | --------- | ------ | ------------------- |
    | 1    | *FIBEntry | nil    | 返回FIB表项对象指针 |

- **AddOrUpdateNextHop**

  - 概述：传入一个Identifier对象作为参数，尝试在FIB表中添加新表项。 开发者应该注意考虑多线程调用此接口时的线程安全问题。

  - 参数：

    | 序号 | 名称          | 类型        | 示例值 | 说明                   |
    | ---- | ------------- | ----------- | ------ | ---------------------- |
    | 1    | identifierPtr | *Identifier | 无     | 网络分组的标识对象指针 |
    | 2    | logicFaceId   | Uint64      | 4342   | 逻辑接口号             |
    | 3    | cost          | Uint64      | 0      | 链路开销               |

  - 返回值：

    | 序号 | 类型      | 示例值 | 说明                |
    | ---- | --------- | ------ | ------------------- |
    | 1    | *FIBEntry | nil    | 返回FIB表项对象指针 |

- **EraseByIdentifier**

  - 概述：传入一个Identifier对象作为参数，尝试在FIB表中删除表项。 开发者应该注意考虑多线程调用此接口时的线程安全问题。

  - 参数：

    | 序号 | 名称          | 类型        | 示例值 | 说明                   |
    | ---- | ------------- | ----------- | ------ | ---------------------- |
    | 1    | identifierPtr | *Identifier | 无     | 网络分组的标识对象指针 |

  - 返回值：

    | 序号 | 类型  | 示例值 | 说明                                  |
    | ---- | ----- | ------ | ------------------------------------- |
    | 1    | error | nil    | 如果成功，则返回nil，否则返回错误信息 |

- **EraseByFIBEntry**

  - 概述：入一个FIBEntry对象指针作为参数，尝试在FIB表中删除表项。 开发者应该注意考虑多线程调用此接口时的线程安全问题。

  - 参数：

    | 序号 | 名称        | 类型      | 示例值 | 说明             |
    | ---- | ----------- | --------- | ------ | ---------------- |
    | 1    | fibEntryPtr | *FIBEntry | 无     | FIBEntry对象指针 |

  - 返回值：

    | 序号 | 类型  | 示例值 | 说明                                  |
    | ---- | ----- | ------ | ------------------------------------- |
    | 1    | error | nil    | 如果成功，则返回nil，否则返回错误信息 |

- **RemoveNextHopByFace**

  - 概述：删除FIB表中，所有仅以logicFaceId为下一跳的表项。 开发者应该注意考虑多线程调用此接口时的线程安全问题。

  - 参数：

    | 序号 | 名称        | 类型   | 示例值 | 说明           |
    | ---- | ----------- | ------ | ------ | -------------- |
    | 1    | logicFaceId | Uint64 | 67     | 逻辑接口的ID号 |

  - 返回值：

    | 序号 | 类型   | 示例值 | 说明             |
    | ---- | ------ | ------ | ---------------- |
    | 1    | Uint64 | 0      | 返回删除的表项数 |

- **Size**

  - 概述：获得FIB表的大小（表项数）

  - 参数：无

  - 返回值：

    | 序号 | 类型 | 示例值 | 说明       |
    | ---- | ---- | ------ | ---------- |
    | 1    | int  | 0      | 返回表项数 |

### 1.5 PITEntry

- **SetExpiryTimer**

  - 概述：设置PIT表项的超时回调

  - 参数：

    | 序号 | 名称                | 类型            | 示例值 | 说明       |
    | ---- | ------------------- | --------------- | ------ | ---------- |
    | 1    | duration            | Uint64          | 156734 | Unix时间戳 |
    | 2    | expiryTimerCallback | func(*PITEntry) | 无     | 回调函数   |

  - 返回值：无

- ##### CancelTimer

  - 概述：取消定时器
  - 参数：无
  - 返回值：无

- **GetInterest**

  - 概述：获得表项中的兴趣包

  - 参数：无

  - 返回值：

    | 序号 | 类型       | 示例值 | 说明           |
    | ---- | ---------- | ------ | -------------- |
    | 1    | * Interest | nil    | 兴趣包对象指针 |

- **GetIdentifier**

  - 概述：获得表项中的兴趣包的标识

  - 参数：无

  - 返回值：

    | 序号 | 类型        | 示例值 | 说明         |
    | ---- | ----------- | ------ | ------------ |
    | 1    | *Identifier | nil    | 标识对象指针 |

- **CanMatch**

  - 概述：判断该表项是否跟一个兴趣包匹配

  - 参数：

    | 序号 | 名称        | 类型      | 示例值 | 说明           |
    | ---- | ----------- | --------- | ------ | -------------- |
    | 1    | interestPtr | *Interest | 无     | 逻辑接口的ID号 |

  - 返回值：

    | 序号 | 类型 | 示例值 | 说明     |
    | ---- | ---- | ------ | -------- |
    | 1    | bool | true   | 是否匹配 |

- **GetInRecords**

  - 概述：获得注入接口记录列表

  - 参数：无

  - 返回值：

    | 序号 | 类型       | 示例值 | 说明             |
    | ---- | ---------- | ------ | ---------------- |
    | 1    | []InRecord | []     | InRecord对象数组 |

- **HasInRecords**

  - 概述：判断注入接口记录列表是否为空

  - 参数：无

  - 返回值：

    | 序号 | 类型 | 示例值 | 说明                   |
    | ---- | ---- | ------ | ---------------------- |
    | 1    | bool | true   | 判断注入记录表是否为空 |

- **GetInRecord**

  - 概述：通过LogicFaceId来查找有无相应的流入记录

  - 参数：

    | 序号 | 名称        | 类型   | 示例值 | 说明       |
    | ---- | ----------- | ------ | ------ | ---------- |
    | 1    | logicFaceId | Uint64 | 3432   | 逻辑接口号 |

  - 返回值：

    | 序号 | 类型 | 示例值 | 说明                   |
    | ---- | ---- | ------ | ---------------------- |
    | 1    | bool | true   | 判断注入记录表是否为空 |

- **InsertOrUpdateInRecord**

  - 概述：通过LogicFaceId来插入或更新相应的流入记录

  - 参数：

    | 序号 | 名称        | 类型       | 示例值 | 说明           |
    | ---- | ----------- | ---------- | ------ | -------------- |
    | 1    | logicFaceId | Uint64     | 3432   | 逻辑接口号     |
    | 2    | interestPtr | * Interest | 无     | 兴趣包对象指针 |

  - 返回值：

    | 序号 | 类型      | 示例值 | 说明             |
    | ---- | --------- | ------ | ---------------- |
    | 1    | *InRecord | 无     | InRecord对象指针 |

- **DeleteInRecord**

  - 概述：通过LogicFaceId来删除相应的流入记录 

  - 参数：

    | 序号 | 名称        | 类型   | 示例值 | 说明       |
    | ---- | ----------- | ------ | ------ | ---------- |
    | 1    | logicFaceId | Uint64 | 3432   | 逻辑接口号 |

  - 返回值：

    | 序号 | 类型  | 示例值 | 说明                          |
    | ---- | ----- | ------ | ----------------------------- |
    | 1    | error | 无     | 成功则返回nil，否则返回错原因 |

- **ClearInRecords**

  - 概述：删除所有流入记录

  - 参数：无

  - 返回值：无

- **GetOutRecords**

  - 概述：获得流出接口记录列表

  - 参数：无

  - 返回值：

    | 序号 | 类型        | 示例值 | 说明              |
    | ---- | ----------- | ------ | ----------------- |
    | 1    | []OutRecord | []     | OutRecord对象数组 |

- **HasOutRecords**

  - 概述：判断流出接口记录列表是否为空

  - 参数：无

  - 返回值：

    | 序号 | 类型 | 示例值 | 说明                   |
    | ---- | ---- | ------ | ---------------------- |
    | 1    | bool | true   | 判断流出记录表是否为空 |

- **GetOutRecord**

  - 概述：通过LogicFaceId来查找有无相应的流出记录 

  - 参数：

    | 序号 | 名称        | 类型   | 示例值 | 说明       |
    | ---- | ----------- | ------ | ------ | ---------- |
    | 1    | logicFaceId | Uint64 | 3432   | 逻辑接口号 |

  - 返回值：

    | 序号 | 类型 | 示例值 | 说明                   |
    | ---- | ---- | ------ | ---------------------- |
    | 1    | bool | true   | 判断流出记录表是否为空 |

- **InsertOrUpdateOutRecord**

  - 概述：通过LogicFaceId来插入或更新相应的流出记录

  - 参数：

    | 序号 | 名称        | 类型       | 示例值 | 说明           |
    | ---- | ----------- | ---------- | ------ | -------------- |
    | 1    | logicFaceId | Uint64     | 3432   | 逻辑接口号     |
    | 2    | interestPtr | * Interest | 无     | 兴趣包对象指针 |

  - 返回值：

    | 序号 | 类型      | 示例值 | 说明             |
    | ---- | --------- | ------ | ---------------- |
    | 1    | *InRecord | 无     | InRecord对象指针 |

- **DeleteOutRecord**

  - 概述：通过LogicFaceId来删除相应的流出记录 

  - 参数：

    | 序号 | 名称        | 类型   | 示例值 | 说明       |
    | ---- | ----------- | ------ | ------ | ---------- |
    | 1    | logicFaceId | Uint64 | 3432   | 逻辑接口号 |

  - 返回值：

    | 序号 | 类型  | 示例值 | 说明                          |
    | ---- | ----- | ------ | ----------------------------- |
    | 1    | error | 无     | 成功则返回nil，否则返回错原因 |

- **ClearOutRecords**

  - 概述：删除所有流入记录

  - 参数：无

  - 返回值：无

### 1.6 PIT

PIT表应该设计专门的定时器，用于定时清理超时的PIT表项，PIT提供设置超时回调函数的接口。

- **Size**

  - 概述：获得PIT表的大小（表项数） 

  - 参数：无

  - 返回值：

    | 序号 | 类型 | 示例值 | 说明       |
    | ---- | ---- | ------ | ---------- |
    | 1    | int  | 0      | 返回表项数 |

- **Find**

  - 概述：通过兴趣包查找匹配的表项

  - 参数：

    | 序号 | 名称        | 类型      | 示例值 | 说明           |
    | ---- | ----------- | --------- | ------ | -------------- |
    | 1    | interestPtr | *Interest | 无     | 兴趣包对象指针 |

  - 返回值：

    | 序号 | 类型      | 示例值 | 说明                                      |
    | ---- | --------- | ------ | ----------------------------------------- |
    | 1    | *PITEntry | 无     | PIT表项对象指针                           |
    | 2    | error     | nil    | 如果匹配成功，则返回nil，否则返回错误信息 |

- **Insert**

  - 概述：将兴趣包插入PIT表 

  - 参数：

    | 序号 | 名称        | 类型      | 示例值    | 说明           |
    | ---- | ----------- | --------- | --------- | -------------- |
    | 1    | interestPtr | *Interest | 无        | 兴趣包对象指针 |
    | 2    | logicFaceId | Uint64    | 7         | 逻辑接口号     |
    | 3    | expireTime  | Uint64    | 156735267 | Unix时间戳     |

  - 返回值：

    | 序号 | 类型      | 示例值 | 说明            |
    | ---- | --------- | ------ | --------------- |
    | 1    | *PITEntry | 无     | PIT表项对象指针 |

- **FindAllDataMatches**

  - 概述：返回所有与Data匹配的PIT表项对象，匹配过程应该在PIT表中删除匹配过的表项。

  - 参数：

    | 序号 | 名称    | 类型  | 示例值 | 说明           |
    | ---- | ------- | ----- | ------ | -------------- |
    | 1    | dataPtr | *Data | 无     | 数据包对象指针 |

  - 返回值：

    | 序号 | 类型       | 示例值 | 说明            |
    | ---- | ---------- | ------ | --------------- |
    | 1    | []PITEntry | 无     | PIT表项对象数组 |

- **EraseByPITEntry**

  - 概述：传入一个PITEntry对象指针，尝试删除指定表项

  - 参数：

    | 序号 | 名称        | 类型      | 示例值 | 说明           |
    | ---- | ----------- | --------- | ------ | -------------- |
    | 1    | pitEntryPtr | *PITEntry | 无     | 数据包对象指针 |

  - 返回值：

    | 序号 | 类型  | 示例值 | 说明                                  |
    | ---- | ----- | ------ | ------------------------------------- |
    | 1    | error | nil    | 如果成功，则返回nil，否则返回错误信息 |

- **EraseByLogicFaceID**

  - 概述：删除所有以logicFaceId为流入接口号或流出接口号的表项。

  - 参数：

    | 序号 | 名称        | 类型   | 示例值 | 说明       |
    | ---- | ----------- | ------ | ------ | ---------- |
    | 1    | logicFaceId | Uint64 | 46     | 逻辑接口号 |

  - 返回值：

    | 序号 | 类型  | 示例值 | 说明                                  |
    | ---- | ----- | ------ | ------------------------------------- |
    | 1    | error | nil    | 如果成功，则返回nil，否则返回错误信息 |

### 1.7 CSEntry

- **GetData**

  - 概述：获得表项中的数据包指针。

  - 参数：无

  - 返回值：

    | 序号 | 类型  | 示例值 | 说明           |
    | ---- | ----- | ------ | -------------- |
    | 1    | *Data | nil    | 数据包对象指针 |

- **GetIdentifier**

  - 概述：获得表项中的数据包的标识的指针。

  - 参数：无

  - 返回值：

    | 序号 | 类型        | 示例值 | 说明         |
    | ---- | ----------- | ------ | ------------ |
    | 1    | *Identifier | nil    | 标识对象指针 |

- **GetStaleTime**

  - 概述：获得表项变旧时间（变得不新鲜的时间）。

  - 参数：无

  - 返回值：

    | 序号 | 类型  | 示例值     | 说明             |
    | ---- | ----- | ---------- | ---------------- |
    | 1    | Int64 | 1657465790 | Unix时间戳（秒） |

- **IsStale**

  - 概述：判断表项是否已经变旧（变得不新鲜）。

  - 参数：无

  - 返回值：

    | 序号 | 类型 | 示例值 | 说明 |
    | ---- | ---- | ------ | ---- |
    | 1    | bool | true   | 无   |

- **UpdateStaleTime**

  - 概述：更新表项的变旧时间。

  - 参数：

    | 序号 | 名称         | 类型   | 示例值     | 说明       |
    | ---- | ------------ | ------ | ---------- | ---------- |
    | 1    | newStaleTime | Uint64 | 1567835427 | Unix时间戳 |

  - 返回值：无

- **CanSatisfy**

  - 概述：判断表项是否可以与某个兴趣包匹配。

  - 参数：

    | 序号 | 名称        | 类型      | 示例值 | 说明           |
    | ---- | ----------- | --------- | ------ | -------------- |
    | 1    | interestPtr | *Interest | 无     | 兴趣包对象指针 |

  - 返回值：

    | 序号 | 类型 | 示例值 | 说明 |
    | ---- | ---- | ------ | ---- |
    | 1    | bool | true   | 无   |

### 1.8 CS

CS在初始化的过程中，应该加载配置文件中的缓存大小和缓存替换策略，需求读取全局的MIR配置文件，全局配置文件请求参考7.3.2的说明。

- **Size**

  - 概述：获得CS的大小（表项数） 

  - 参数：无

  - 返回值：

    | 序号 | 类型   | 示例值 | 说明       |
    | ---- | ------ | ------ | ---------- |
    | 1    | Uint64 | 0      | 返回表项数 |

- **Insert**

  - 概述：往内容仓库中添加一个Data包。

  - 参数：

    | 序号 | 名称    | 类型  | 示例值 | 说明         |
    | ---- | ------- | ----- | ------ | ------------ |
    | 1    | dataPtr | *Data | 无     | Data对象指针 |

  - 返回值：

    | 序号 | 类型     | 示例值 | 说明               |
    | ---- | -------- | ------ | ------------------ |
    | 1    | *CSEntry | nil    | 返回插入的表项指针 |

- **EraseByIdentifier**

  - 概述：通过内容名来删除CS中的一个数据包。

  - 参数：

    | 序号 | 名称          | 类型        | 示例值 | 说明               |
    | ---- | ------------- | ----------- | ------ | ------------------ |
    | 1    | identifierPtr | *Identifier | 无     | Identifier对象指针 |

  - 返回值：

    | 序号 | 类型  | 示例值 | 说明                                  |
    | ---- | ----- | ------ | ------------------------------------- |
    | 1    | error | nil    | 如果成功，则返回nil，否则返回错误信息 |

- **Find**

  - 概述：通过兴趣包来查询CS中的一个数据包。

  - 参数：

    | 序号 | 名称        | 类型      | 示例值 | 说明             |
    | ---- | ----------- | --------- | ------ | ---------------- |
    | 1    | interestPtr | *Interest | 无     | Interest对象指针 |

  - 返回值：

    | 序号 | 类型     | 示例值 | 说明               |
    | ---- | -------- | ------ | ------------------ |
    | 1    | *CSEntry | nil    | 返回插入的表项指针 |

### 1.9 StrategyTableEntry 

- **GetStrategyName**

  - 概述：获得策略的名称。

  - 参数：无

  - 返回值：

    | 序号 | 类型   | 示例值      | 说明                     |
    | ---- | ------ | ----------- | ------------------------ |
    | 1    | String | “broadcast” | 返回转发策略的名称字符串 |

- **SetStrategyName**

  - 概述：设置策略名称。

  - 参数：

    | 序号 | 名称         | 类型   | 示例值      | 说明     |
    | ---- | ------------ | ------ | ----------- | -------- |
    | 1    | strategyName | String | “broadcast” | 策略名称 |

  - 返回值：无

- **GetPrefix**

  - 概述：获取标识前缀。

  - 参数：无

  - 返回值：

    | 序号 | 名称   | 类型        | 示例值 | 说明     |
    | ---- | ------ | ----------- | ------ | -------- |
    | 1    | prefix | *Identifier | nil    | 标识前缀 |

- **SetPrefix**

  - 概述：获取标识前缀。

  - 参数：

    | 序号 | 名称   | 类型        | 示例值 | 说明     |
    | ---- | ------ | ----------- | ------ | -------- |
    | 1    | prefix | *Identifier | nil    | 标识前缀 |

  - 返回值：无

- **GetStrategy**

  - 概述：获取策略条目对应的策略结构体的指针。

  - 参数：无

  - 返回值：

    | 序号 | 名称   | 类型      | 示例值 | 说明         |
    | ---- | ------ | --------- | ------ | ------------ |
    | 1    | prefix | *Strategy | nil    | 策略实例指针 |

- **SetStrategy**

  - 概述：设置策略条目对应的策略结构体的指针。

  - 参数：

    | 序号 | 名称   | 类型       | 示例值 | 说明         |
    | ---- | ------ | ---------- | ------ | ------------ |
    | 1    | prefix | * Strategy | nil    | 策略实例指针 |

  - 返回值：无

### 1.10 StrategyTable

用来为某些特定的前缀设置一个策略。

- **Size**

  - 概述：获得StrategyTable的大小（表项数） 

  - 参数：无

  - 返回值：

    | 序号 | 类型   | 示例值 | 说明       |
    | ---- | ------ | ------ | ---------- |
    | 1    | Uint64 | 0      | 返回表项数 |

- **SetDefaultStrategy**

  - 概述：为所有的前缀设置一个默认的策略

  - 参数：

    | 序号 | 名称         | 类型   | 示例值      | 说明     |
    | ---- | ------------ | ------ | ----------- | -------- |
    | 1    | strategyName | String | “broadcast” | 策略名称 |

  - 返回值：无

- **Insert**

  - 概述：往策略表中插入一个策略。

  - 参数：

    | 序号 | 名称          | 类型        | 示例值 | 说明     |
    | ---- | ------------- | ----------- | ------ | -------- |
    | 1    | identifierPtr | *Identifier | 无     | 标识前缀 |
    | 2    | strategyName  | String      | 无     | 策略名称 |
    | 3    | strategy      | *Strategy   | 无     | 策略实例 |

  - 返回值：

    | 序号 | 类型           | 示例值 | 说明               |
    | ---- | -------------- | ------ | ------------------ |
    | 1    | *StrategyEntry | nil    | 返回插入的表项指针 |

- **Erase**

  - 概述：通过前缀删除策略表中策略。

  - 参数：

    | 序号 | 名称          | 类型        | 示例值 | 说明     |
    | ---- | ------------- | ----------- | ------ | -------- |
    | 1    | identifierPtr | *Identifier | 无     | 标识前缀 |

  - 返回值：无

- **FindEffectiveStrategyEntry**

  - 概述：查询和一个指定的名称前缀匹配的策略条目（最长前缀匹配）。

  - 参数：

    | 序号 | 名称          | 类型        | 示例值 | 说明     |
    | ---- | ------------- | ----------- | ------ | -------- |
    | 1    | identifierPtr | *Identifier | 无     | 标识前缀 |

  - 返回值：

    | 序号 | 类型           | 示例值 | 说明         |
    | ---- | -------------- | ------ | ------------ |
    | 1    | *StrategyEntry | nil    | 返回表项指针 |

## 2. 关键数据结构设计

说明关键数据结构的设计。主要包括FIB数据结构、PIT数据结构、CS数据结构等。

### 2.1 FIB表结构设计

FIB表的每项是一个键值对，其中键是Identifier，而值是出口的逻辑接口号。一个Identifier前缀可能会对应多个逻辑接口号。表的形象结构如表所示，请实现者自行设计表的索引结构。""

```json
[
  "/hello": {
    "nexthopList": [
      {
        "logicFaceId": 233,
        "cost": 10
      },
      {
        "logicFaceId": 234,
        "cost": 12
      }
    ]
  }
]
```

### 2.2 PIT表结构设计

PIT表的每项是一个键值对，其中键是Identifier，而值是入口的逻辑接口号、过期时间等信息。一个Identifier前缀可能会对应多个逻辑接口号。表的形象结构如表所示，请实现者自行设计表的索引结构。

流入表/流出表中的超时时间超时的时候，不用触发超时处理，只有表项的总超时时间超时的时候才能触发超时处理。

```json
{
  "/hello": {
    "inRecords": [
    	{
        "logicFaceId": 233,
        "interestPtr": nil,
        "expireTime": 1614178790000,
        "lastNonce": 300
      }
    ],
    "outRecords": [
      {
        "logicFaceId": 234,
        "expireTime": 1614178790000,
        "lastNonce": 300
      }
    ]
  }
}
```

### 2.3 CS表结构设计

CS表的每项是一个键值对，其中键是Identifier，而值是数据包指针、过期时间和命中计数等信息。一个Identifier前缀只会对应一个值。表的形象结构如表所示，请实现者自行设计表的索引结构。

```json
{
  "/hello": {
    "data": Data,
    "staleTime": 1614178790000,
    "interestPtr": nil
  }
}
```

## 3. 类图

![类图 -- table](https://gitee.com/quejianming/pic-bed/raw/master/uPic/2021/02/24/%E7%B1%BB%E5%9B%BE%20--%20table-1614158092.svg)